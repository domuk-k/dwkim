# Persona API

ê°œì¸í™”ëœ RAG+LLM ê¸°ë°˜ ì±—ë´‡ APIë¡œ, dwkimì˜ ê°œì¸ ê²½í—˜ê³¼ ìƒê°ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ë§ì¶¤í˜• AI ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

- **RAG (Retrieval-Augmented Generation) ì—”ì§„**: ë²¡í„° ê²€ìƒ‰ê³¼ LLMì„ í†µí•©í•œ ì •í™•í•œ ë‹µë³€ ìƒì„±
- **Chroma ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤**: ë¬¸ì„œ ì„ë² ë”© ë° ì˜ë¯¸ì  ê²€ìƒ‰
- **OpenAI GPT ëª¨ë¸ ì—°ë™**: ê³ í’ˆì§ˆ ìì—°ì–´ ìƒì„±
- **Redis ê¸°ë°˜ Rate Limiting**: API ì‚¬ìš©ëŸ‰ ì œí•œ ë° ë³´ì•ˆ
- **Abuse Detection**: ì•…ì˜ì  ìš”ì²­ íƒì§€ ë° ì°¨ë‹¨
- **Swagger ìë™ ë¬¸ì„œí™”**: API ë¬¸ì„œ ìë™ ìƒì„±
- **Docker ì»¨í…Œì´ë„ˆí™”**: ì‰¬ìš´ ë°°í¬ ë° ê°œë°œ í™˜ê²½
- **TDD ê¸°ë°˜ ê°œë°œ**: Jest + Supertest í…ŒìŠ¤íŠ¸ í™˜ê²½

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Fastify API   â”‚    â”‚   Chroma DB     â”‚    â”‚   OpenAI API    â”‚
â”‚   Server        â”‚â—„â”€â”€â–ºâ”‚   (Vector DB)   â”‚    â”‚   (LLM)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis         â”‚    â”‚   RAG Engine    â”‚    â”‚   Rate Limiting â”‚
â”‚   (Cache/Rate)  â”‚    â”‚   (Core Logic)  â”‚    â”‚   & Security    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ìš”êµ¬ì‚¬í•­

- Node.js 18+
- Docker & Docker Compose
- OpenAI API Key
- Redis (Dockerë¡œ ì œê³µ)
- Chroma DB (Dockerë¡œ ì œê³µ)

## ğŸ› ï¸ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. ì €ì¥ì†Œ í´ë¡ 

```bash
git clone <repository-url>
cd packages/persona-api
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
cp .env.example .env
```

`.env` íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ ë‹¤ìŒ ê°’ë“¤ì„ ì„¤ì •í•˜ì„¸ìš”:

```env
# OpenAI API Key (í•„ìˆ˜)
OPENAI_API_KEY=your_openai_api_key_here

# ê¸°íƒ€ ì„¤ì • (ì„ íƒì‚¬í•­)
PORT=3000
REDIS_HOST=localhost
CHROMA_URL=http://localhost:8000
```

### 3. Dockerë¡œ ì‹¤í–‰ (ê¶Œì¥)

```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up --build

# ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
docker-compose up -d --build
```

### 4. ë¡œì»¬ ê°œë°œ í™˜ê²½

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm test
```

## ğŸ“š API ì—”ë“œí¬ì¸íŠ¸

### ì±„íŒ… API

- `POST /api/v1/chat` - ê°œì¸í™”ëœ ì±„íŒ… ì‘ë‹µ
- `GET /api/v1/search` - ë¬¸ì„œ ê²€ìƒ‰
- `GET /api/v1/status` - RAG ì—”ì§„ ìƒíƒœ í™•ì¸

### í—¬ìŠ¤ì²´í¬

- `GET /health` - ê¸°ë³¸ ì„œë²„ ìƒíƒœ
- `GET /health/detailed` - ìƒì„¸ ìƒíƒœ (RAG ì—”ì§„ í¬í•¨)
- `GET /health/redis` - Redis ì—°ê²° ìƒíƒœ

### API ë¬¸ì„œ

- `GET /documentation` - Swagger UI

## ğŸ”§ RAG ì—”ì§„ êµ¬ì„± ìš”ì†Œ

### 1. VectorStore (Chroma DB)

- ë¬¸ì„œ ì„ë² ë”© ì €ì¥ ë° ê²€ìƒ‰
- ë©”íƒ€ë°ì´í„° ê¸°ë°˜ í•„í„°ë§
- ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰

### 2. LLM Service (OpenAI)

- GPT ëª¨ë¸ì„ í†µí•œ ë‹µë³€ ìƒì„±
- ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì‘ë‹µ
- í† í° ì‚¬ìš©ëŸ‰ ì¶”ì 

### 3. RAG Engine

- ë²¡í„° ê²€ìƒ‰ê³¼ LLM í†µí•©
- ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° ê´€ë¦¬
- ëŒ€í™” íˆìŠ¤í† ë¦¬ ì²˜ë¦¬

## ğŸ§ª í…ŒìŠ¤íŠ¸

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm test

# í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
npm run test:coverage

# í…ŒìŠ¤íŠ¸ ê°ì‹œ ëª¨ë“œ
npm run test:watch
```

### í…ŒìŠ¤íŠ¸ êµ¬ì¡°

- `src/tests/ragEngine.test.ts` - RAG ì—”ì§„ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- `src/tests/chat.test.ts` - API í†µí•© í…ŒìŠ¤íŠ¸
- `src/tests/health.test.ts` - í—¬ìŠ¤ì²´í¬ í…ŒìŠ¤íŠ¸

## ğŸ”’ ë³´ì•ˆ ê¸°ëŠ¥

### Rate Limiting

- IP ê¸°ë°˜ ìš”ì²­ ì œí•œ
- Redisë¥¼ í†µí•œ ë¶„ì‚° ì²˜ë¦¬
- ìœˆë„ìš° ê¸°ë°˜ ì œí•œ (15ë¶„/100ìš”ì²­)

### Abuse Detection

- ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŒ¨í„´ íƒì§€
- ì—°ì† ì˜¤ë¥˜ ìˆ˜ ëª¨ë‹ˆí„°ë§
- ìë™ IP ì°¨ë‹¨

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸

```bash
# ê¸°ë³¸ ìƒíƒœ í™•ì¸
curl http://localhost:3000/health

# ìƒì„¸ ìƒíƒœ í™•ì¸ (RAG ì—”ì§„ í¬í•¨)
curl http://localhost:3000/health/detailed

# Redis ìƒíƒœ í™•ì¸
curl http://localhost:3000/health/redis
```

### ë¡œê·¸ ë ˆë²¨

- `ERROR`: ì˜¤ë¥˜ ë° ì˜ˆì™¸ ìƒí™©
- `WARN`: ê²½ê³  ë° ì£¼ì˜ì‚¬í•­
- `INFO`: ì¼ë°˜ ì •ë³´
- `DEBUG`: ìƒì„¸ ë””ë²„ê·¸ ì •ë³´

## ğŸš€ ë°°í¬

### Docker ë°°í¬

```bash
# í”„ë¡œë•ì…˜ ë¹Œë“œ
docker build -t persona-api .

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -p 3000:3000 --env-file .env persona-api
```

### í™˜ê²½ë³„ ì„¤ì •

- `NODE_ENV=development` - ê°œë°œ í™˜ê²½
- `NODE_ENV=production` - í”„ë¡œë•ì…˜ í™˜ê²½

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## ğŸ“„ ë¼ì´ì„ ìŠ¤

MIT License

## ğŸ“ ì§€ì›

ë¬¸ì œê°€ ìˆê±°ë‚˜ ì§ˆë¬¸ì´ ìˆìœ¼ì‹œë©´ ì´ìŠˆë¥¼ ìƒì„±í•´ ì£¼ì„¸ìš”.
